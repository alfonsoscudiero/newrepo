<!-- views/inventory/details.ejs -->

<section id="inv-detail">
  <div class="detail-container">
    <!-- Vehicle title -->
    <h1><%= vehicle.inv_year %> <%= vehicle.inv_make %> <%= vehicle.inv_model %></h1>

    <!-- Main vehicle details layout -->
    <div class="detail-wrapper">
      <!-- Vehicle Image -->
      <div class="detail-media">
        <img src="<%= vehicle.inv_image %>" alt="Image of <%= vehicle.inv_make %>">
      </div>

      <!-- Vehicle Specs -->
      <div class="detail-info">
        <h2><%= vehicle.inv_make %> <%= vehicle.inv_model %> Details</h2>

        <div class="field price"><b>Price: $<%= priceFormatted %></b></div>
        <div class="field"><b>Description:</b> <%= vehicle.inv_description %></div>
        <div class="field"><b>Color:</b> <%= vehicle.inv_color %></div>
        <div class="field"><b>Miles:</b> <%= milesFormatted %></div>
      </div>
    </div> 
    
    <!-- Review Section -->
    <!-- Final Project | Weeks 12-14 -->
    <div class="reviews-section">
      <h3>Customer Reviews</h3>
      <!-- Flash messages for review success or failure -->
      <div class="flash-messages">
        <%- messages() %>
      </div>
      <!-- If there are reviews -->
      <% if (hasReviews) { %>
        <div class="reviews-list">
          <% reviews.forEach(function (review) { %>
            <article class="review-card">
              <!-- Name + date -->
              <div class="review-meta">
                <div class="review-name"><%= review.review_screenname %></div>
                <div class="review-date"><%= review.review_date_formatted %></div>
              </div>

              <!-- Review text -->
              <p class="review-text"><%= review.review_text %></p>
            </article>
          <% }) %>
        </div>
      <!-- If there are NO reviews -->
      <% } else { %>
        <p class="reviews-empty">Be the first to write a review</p>
      <% } %>

      <!-- If NOT logged in -->
      <% if (!loggedin) { %>
        <p class="login-message">
          <a href="/account/login">Log in to add a review.</a>
        </p>

      <!-- If logged in -->
      <% } else { %>
        <!-- Server-side validation errors -->
        <% if (typeof errors !== "undefined" && !errors.isEmpty()) { %>
          <ul class="notice">
            <% errors.array().forEach(error => { %>
              <li><%= error.msg %></li>
            <% }) %>
          </ul>
        <% } %>

        <div class="review-form-card">
          <h4>Leave a Review</h4>
          <form action="/reviews/add" method="post" class="review-form">
            <!-- Screen name (read-only) -->
            <label for="screen_name">Screen Name:
              <input 
                type="text" 
                id="screen_name"
                name="screen_name"
                value="<%= screenName %>"
                readonly
              >
            </label>
            <!-- Review text -->
            <label for="review_text">Review:</label>
            <textarea 
              name="review_text" 
              required 
              placeholder="Write your review..."
              autofocus
              <%= typeof review_text !== "undefined" ? review_text : "" %>
            ></textarea>
            <!-- Hidden fields -->
            <input type="hidden" name="inv_id" value="<%= inv_id %>">
            <input type="hidden" name="account_id" value="<%= accountId %>">

            <button type="submit" class="btn primary">Submit Review</button>
          </form>

        </div> <!-- end review-form-card -->
      <% } %>

    </div><!-- end reviews-section -->
  </div> <!-- end .detail-container -->
</section>